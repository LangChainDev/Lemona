# Lemona

DB catalog exporter in SQLAlchemy form.

Lemona is a tool that uses sqlalchemy metadata to export database catalog in sqlalchemy format.



After exporting the db schema using lemona, you can use alembic to manage the migration.



## Dependency

- python3.6 

- sqlalchemy

- alembic(optional)




## How to use

### Postgresql

#### Alembic
Go to the directory where you want to run alembic version control and execute the following command.

I created a project name as alembic for explanation. You can create it with the name you want.
```shell
$ alembic init alembic 
```
Now, the alembic version control project is created with the following directory structure.
<!-- AUTO-GENERATED-CONTENT:START (DIRTREE:dir=./) -->
```
myproject-directory-tree/
├── alembic.ini
  └── myproject
    └── versions
    └── env.py
    └── README
    └── script.py.mako
```

<!-- AUTO-GENERATED-CONTENT:END -->

### ※ Importance 
You must execute the command with the name <bold>`"initial_migraion"`<bold>.
If you do not naming like this, you can not parse the sequence part of postgresql properly.

```shell
$ alembic revision --autogenerate -m "initial_migration"
```
In the `alembic.ini` file, put the url of the database to be version controlled as alembic.

```shell
# the output encoding used when revision files
# are written from script.py.mako
# output_encoding = utf-8

sqlalchemy.url = driver://user:pass@localhost/dbname
```



PostgreSQL requires that you set up a schema when there are multiple schemas in the database.

You can fill in the following settings in `meta_model.py`.

```python
SCHEMA_NAME = ''
# DEV_DATABASE: Development Database Information
DEV_DATABASE = {'user': '',
                'password': '',
                'host': '',
                'database': ''}

# PROD_DATABASE: Product Database Information
PROD_DATABASE = {'user': '',
                 'password': '',
                 'host': '',
                 'database': ''}
```


Alembic does not provide a migration code to create a sequence.


So the `meta_model.py` module creates a sequence using sqlalchemy.


```shell
$ python3 meta_model.py
```


Now you can run the migration code generated by alembic with the following command.

```shell
$ alembic upgrade head
```


### More info

sqlAlchemy : http://alembic.zzzcomputing.com/en/latest/

Alembic : https://www.sqlalchemy.org/
















